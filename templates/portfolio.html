{% extends "base.html" %}


{% block title %}
- Portfolios
{% endblock %}

{% block head %}

{% endblock %}

{% block body %}
{% if session["user_id"] %}
<nav class="navbar navbar-expand-md navbar-light">
   
    <div class="container-fluid" id="navbar">
        <ul class="navbar-nav me-auto mt-2 text-nowrap">
            <li class="nav-item"><a class="nav-link mango" href="/create_portfolio">new</a></li>
            {% for portfolio in portfolios %}
            <li class="nav-item text-nowrap">
                <div class="nav-link">
                {% if portfolio.id == portfolio_id |int %}
                    <a class="no-underline red" href="/portfolio?folioid={{ portfolio.id }}">{{ portfolio.name }}</a>
                {% else %}
                    <a class="no-underline mango" href="/portfolio?folioid={{ portfolio.id }}">{{ portfolio.name }}</a>
                {% endif %}
                    <a href="/delete_portfolio?folioid={{ portfolio.id }}"><img src="/static/img/cross.png" width="10px" height="10px" alt="remove"></a>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</nav>
<br>
<div class="row">
    <div class="col-md-4 col-12 container-fluid">
    {% if value > 0 %}
        <span class="num-positive head-size">{{ '$%05.2f' % value }}</span><br>
        current value
    {% endif %}
    </div>
    <div class="col-md-4 col-12 container-fluid">
    {% if change >= 0 %}
        <span class="num-positive head-size">{{ '+$%05.2f' % change|abs }}</span>
    {% else %}
        <span class="num-negative head-size">{{ '-$%05.2f' % change|abs }}</span>
    {% endif %}
    <br>
    24h change
    </div>
    <div class="col-md-4 col-12 container-fluid">
    {% if pnl >= 0 %}
        <span class="num-positive head-size">{{ '+$%05.2f' % pnl|abs }}</span>
    {% else %}
        <span class="num-negative head-size">{{ '-$%05.2f' % pnl|abs }}</span>
    {% endif %}
    <br>
    profit/loss
    </div>
</div>
<br>
<div class="table-responsive" style="width: 99%">
    <table class="" style="table-layout: fixed; width: 100%;">
        <thead>
            <th style="width: 20%;">coin</th>
            <th style="width: 12%;">current price</th>
            <th style="width: 12%;">amount</th>
            <th style="width: 12%;">avg buy</th>
            <th style="width: 12%;">total invest</th>
            <th style="width: 12%;">value</th>
            <th style="width: 12%; text-align: right;">pnl</th>
        </thead>
        <tbody>
            {% if coins %}
                {% for coin in coins %}
            <tr class="{{ 'row-lighter' if (loop.index0 % 2) == 0 else '' }} row-topb" style="height: 35px;">
                <td style="text-align:justify;"><img src="{{ coin.icon_url }}" width="20" height="20"> {{ coin.name }} (<span style="font-size: smaller;">{{ coin.symbol }}</span>)</td>
                <td>{{ coin.current_price }}</td>
                <td>{{ (coin.quantity | float) }}</td>
                <td>{{ coin.price | float }}</td>
                {% set total_price = (coin.price * coin.quantity) %}
                <td>{{ "%0.2f"|format( total_price ) }}</td>
                {% set total_value = (coin.current_price * coin.quantity) %}
                <td>{{ "%0.2f"|format( total_value ) }}</td>
                
                {% set change = (total_value - total_price) %}
                {% set perc_change = (change / total_price ) * 100  %}
                {% if change >= 0 %}
                    <td class="num-positive" style="text-align: right;">
                {% else %}
                    <td class="num-negative" style="text-align: right;">
                {% endif %}
                {{ "$%04.2f"|format( change ) }}<br>
                <span style="font-size: 10pt;">{{ "%5.2f"|format( perc_change ) }}%</span></td>
            </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td colspan="7">no coins in this portfolio</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>
<br>
<a class="nav-link mango" href="/add_coin?folioid={{portfolio_id}}">add currency</a>

{% endif %}
{% endblock %}