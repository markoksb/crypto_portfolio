{% extends "base.html" %}

{% block title %}
    Register
{% endblock %}

{% block body %}
    <br>
    Specify the amount and price for the bought {{ coin.name }}<br><br>
    <form action="/add_coin" method="post">
        <input type="hidden" name="pid" value="{{ pid }}">
        <input type="hidden" name="cid" value="{{ coin.id }}">
        <div class="mb-3">
            amount:
            <input autocomplete="off" autofocus class="form-control mx-auto w-auto custom-input" name="amount" id="amount" placeholder="amount" type="text" oninput="autoCalculate()">
        </div>
        <div class="mb-3">
            price:
            <input class="form-control mx-auto w-auto custom-input" name="price" id="price" placeholder="price" type="text" value="{{ coin.current_price }}" oninput="autoCalculate()">
        </div>
        <div class="mb-3">
            total:
            <input class="form-control mx-auto w-auto custom-input" name="total" id="total" placeholder="total" type="text" oninput="autoCalculate()">
        </div>
        <button class="btn custom-button" type="submit">add</button>
    </form>
    <script>
        // TODO: gotta rethink this JS
        function autoCalculate() {
            // Get all the input fields
            const amountInput = document.getElementById('amount');
            const priceInput = document.getElementById('price');
            const totalInput = document.getElementById('total');

            // Parse the current values
            const amount = parseFloat(amountInput.value);
            const price = parseFloat(priceInput.value);
            const total = parseFloat(totalInput.value);

            // Determine the currently active input (being edited)
            const activeElement = document.activeElement;

            // Only calculate and update if the active field is not being changed
            if (activeElement !== amountInput && amount && price && !total) {
                totalInput.value = amount * price;
            } else if (activeElement !== priceInput && amount && total && !price) {
                priceInput.value = total / amount;
            } else if (activeElement !== totalInput && price && total && !amount) {
                amountInput.value = total / price;
            }
        }
    </script>
{% endblock %}
